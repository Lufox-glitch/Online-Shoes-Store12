<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>P&S Online Shoes - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f8f8;
            min-height: 100vh;
        }

        header {
            background: #000;
            color: white;
            padding: 20px 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .logout-btn {
            padding: 10px 20px;
            background: transparent;
            border: 2px solid white;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: white;
            color: #000;
        }

        .main-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .section-title {
            font-size: 32px;
            color: #000;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .stat-card {
            text-align: center;
        }

        .stat-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: #000;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .brand-section {
            margin-bottom: 50px;
        }

        .brand-title {
            font-size: 24px;
            font-weight: 700;
            color: #000;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000;
            display: inline-block;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            border-bottom: 1px solid #e0e0e0;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-weight: 700;
            font-size: 16px;
            color: #000;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .product-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .product-price {
            font-size: 20px;
            font-weight: 800;
            color: #000;
            margin-bottom: 12px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
        }

        .btn-primary {
            background: #ff9800;
            color: white;
            border: 1px solid #ff9800;
        }

        .btn-primary:hover {
            background: #f57c00;
            border-color: #f57c00;
        }

        .btn-secondary {
            background: white;
            color: #000;
            border: 1px solid #000;
        }

        .btn-secondary:hover {
            background: #f0f0f0;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }

        .orders-table th {
            background: #000;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .orders-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .orders-table tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-processing {
            background: #cfe2ff;
            color: #084298;
            border: 1px solid #b6d4fe;
        }

        .status-shipped {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status-delivered {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .cart-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ff9800;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
            transition: all 0.3s;
        }

        .cart-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(255, 152, 0, 0.6);
        }

        .cart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 28px;
            height: 28px;
            background: #000;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            border: 2px solid white;
        }

        .message {
            padding: 15px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #f0f0f0;
            color: #000;
            border: 1px solid #333;
            display: block;
        }

        .message.error {
            background: #f8f8f8;
            color: #000;
            border: 1px solid #fca5a5;
            display: block;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .section-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <div class="logo">P&S Shoes</div>
            <div class="user-info">
                <div class="user-avatar" id="userInitial">U</div>
                <div>
                    <div id="userName" style="font-weight: 600;">Customer</div>
                </div>
            </div>
        </div>
        <div class="header-right">
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </header>

    <div class="main-container">
        <div id="message" class="message"></div>

        <h1 class="section-title">Your Shopping Hub</h1>

        <div class="grid-2">
            <div class="card stat-card">
                <div class="stat-icon" style="font-size: 32px; color: #1a73e8;">‚ñ™</div>
                <div class="stat-value" id="totalOrders">0</div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div class="card stat-card">
                <div class="stat-icon" style="font-size: 32px; color: #1a73e8;">‚ñ™</div>
                <div class="stat-value" id="totalSpent">‚Ç®0</div>
                <div class="stat-label">Total Spent</div>
            </div>
        </div>

        <div class="grid-2" style="margin-top: 30px; display: grid; grid-template-columns: repeat(4, 1fr);">
            <a href="/Online-Shoes-Store/Front-End/checkout.html" class="btn btn-primary" style="padding: 15px; text-align: center; text-decoration: none; border-radius: 8px; background: #1a73e8; color: white; font-weight: 600; transition: all 0.3s;">
                üõí Go to Checkout
            </a>
            <a href="/Online-Shoes-Store/Front-End/customer-orders.html?filter=recent" class="btn btn-primary" style="padding: 15px; text-align: center; text-decoration: none; border-radius: 8px; background: #1a73e8; color: white; font-weight: 600; transition: all 0.3s;">
                üìã Recent Orders
            </a>
            <a href="/Online-Shoes-Store/Front-End/customer-orders.html" class="btn btn-primary" style="padding: 15px; text-align: center; text-decoration: none; border-radius: 8px; background: #1a73e8; color: white; font-weight: 600; transition: all 0.3s;">
                üì¶ View All Orders
            </a>
            <a href="/Online-Shoes-Store/Front-End/track-order.html" class="btn btn-primary" style="padding: 15px; text-align: center; text-decoration: none; border-radius: 8px; background: #10b981; color: white; font-weight: 600; transition: all 0.3s;">
                üîç Track Order
            </a>
        </div>

        <div style="margin-top: 40px; margin-bottom: 30px;">
            <h2 class="section-title">Search Shoes</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="searchInput" placeholder="Search by brand or shoe name..." style="flex: 1; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; transition: border-color 0.3s;">
                <button onclick="searchShoes()" style="padding: 12px 30px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; transition: all 0.3s;">üîç Search</button>
                <button onclick="clearSearch()" style="padding: 12px 30px; background: #999; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; transition: all 0.3s;">Clear</button>
            </div>
            <div id="searchResults" style="display: none; margin-bottom: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px; color: #2e7d32; font-weight: 600;"></div>
        </div>

        <h2 class="section-title">Featured Products</h2>

        <div id="productsContainer">
            <div class="card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                <p style="color: #666;">Loading products...</p>
            </div>
        </div>

        <h2 class="section-title">About P&S Online Shoes</h2>

        <div class="grid-2">
            <div class="card">
                <h3 style="font-size: 20px; color: #000; margin-bottom: 15px; font-weight: 700;">üìç Our Store</h3>
                <p style="color: #666; line-height: 1.8; margin-bottom: 10px;"><strong>P&S Online Shoes</strong></p>
                <p style="color: #666; line-height: 1.8; margin-bottom: 10px;">Premium Footwear Collection</p>
                <p style="color: #666; line-height: 1.8; margin-bottom: 10px;">Panauti, Nepal</p>
                <p style="color: #666; line-height: 1.8; margin-bottom: 10px;"><strong>Email:</strong> P&Sonlineshoe@gmail.com</p>
                <p style="color: #666; line-height: 1.8; margin-bottom: 5px;"><strong>Phone:</strong></p>
                <p style="color: #666; line-height: 1.8; margin-left: 20px; margin-bottom: 5px;">üì± 9765222094</p>
                <p style="color: #666; line-height: 1.8; margin-left: 20px;">üì± 9843973197</p>
            </div>
            <div class="card">
                <h3 style="font-size: 20px; color: #000; margin-bottom: 15px; font-weight: 700;">‚ú® Why Choose Us?</h3>
                <ul style="color: #666; line-height: 2; list-style-position: inside;">
                    <li>‚úì 20 Premium Shoe Brands</li>
                    <li>‚úì Authentic & Genuine Products</li>
                    <li>‚úì Fast & Reliable Delivery</li>
                    <li>‚úì Secure Payment Options</li>
                    <li>‚úì Customer Support 24/7</li>
                    <li>‚úì Easy Returns & Exchanges</li>
                </ul>
            </div>
        </div>

        <div class="card" style="margin-top: 30px;">
            <h3 style="font-size: 20px; color: #000; margin-bottom: 15px; font-weight: 700;">üéØ Our Mission</h3>
            <p style="color: #666; line-height: 1.8;">At P&S Online Shoes, we are committed to providing the finest selection of premium footwear from leading international brands. Our mission is to make quality shoes accessible and affordable for everyone while ensuring exceptional customer service and fast delivery across Nepal.</p>
        </div>
    </div>

    <button class="cart-btn" onclick="toggleCart()">
        üõí
        <span class="cart-count" id="cartCount" style="display: none;">0</span>
    </button>

    <!-- Cart Modal -->
    <div id="cartModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: flex-end;">
        <div style="background: white; width: 100%; max-width: 400px; height: 100vh; display: flex; flex-direction: column; box-shadow: -4px 0 15px rgba(0, 0, 0, 0.2);">
            <!-- Cart Header -->
            <div style="background: #000; color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 24px;">üõí Cart</h2>
                <button onclick="closeCart()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">‚úï</button>
            </div>

            <!-- Cart Items -->
            <div id="cartItemsContainer" style="flex: 1; overflow-y: auto; padding: 20px;">
                <!-- Items will be dynamically inserted here -->
            </div>

            <!-- Cart Footer with Total and Checkout -->
            <div style="border-top: 1px solid #e0e0e0; padding: 20px; background: #f8f8f8;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 18px; font-weight: 700;">
                    <span>Total:</span>
                    <span id="cartTotal" style="color: #1a73e8;">‚Ç®0</span>
                </div>
                <button onclick="goToCheckout()" style="width: 100%; padding: 15px; background: #1a73e8; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 700; cursor: pointer; margin-bottom: 10px; transition: all 0.3s;">
                    Proceed to Checkout
                </button>
                <button onclick="closeCart()" style="width: 100%; padding: 15px; background: white; color: #000; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s;">
                    Continue Shopping
                </button>
            </div>
        </div>
    </div>

    <script src="/Online-Shoes-Store/Front-End/api-client.js"></script>
    <script>
        // Get user info from session/local storage
        function loadUserInfo() {
            // Check if this is a preview/demo mode from owner
            const urlParams = new URLSearchParams(window.location.search);
            const isPreview = urlParams.get('preview') === 'true';
            
            // Priority: currentUser (customer) over owner
            const user = JSON.parse(sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser') || '{}');
            const owner = JSON.parse(localStorage.getItem('currentOwner') || 'null');
            
            // Allow owner to preview store in demo mode
            if (isPreview && owner && owner.role === 'owner') {
                document.getElementById('userName').textContent = 'Demo Customer';
                document.getElementById('userInitial').textContent = 'D';
                return;
            }
            
            // Allow owner to view store as themselves (only if no customer logged in)
            if (!user.id && owner && owner.role === 'owner' && !isPreview) {
                document.getElementById('userName').textContent = owner.first_name || 'Store Owner';
                document.getElementById('userInitial').textContent = (owner.first_name || 'O')[0].toUpperCase();
                return;
            }
            
            // Display customer info (has priority)
            if (user.first_name) {
                const fullName = (user.first_name || '') + ' ' + (user.last_name || '');
                document.getElementById('userName').textContent = fullName.trim();
                document.getElementById('userInitial').textContent = user.first_name[0].toUpperCase();
            } else {
                window.location.href = '/Online-Shoes-Store/index.html';
            }
        }

        // Load products grouped by brand
        async function loadProducts() {
            try {
                const result = await Products.getAll(100, 0);
                if (result.success && result.data.products.length > 0) {
                    // Group products by brand
                    const groupedByBrand = {};
                    result.data.products.forEach(product => {
                        const brand = product.brand || 'Other';
                        if (!groupedByBrand[brand]) {
                            groupedByBrand[brand] = [];
                        }
                        groupedByBrand[brand].push(product);
                    });

                    const container = document.getElementById('productsContainer');
                    let html = '';

                    // Display each brand section
                    Object.keys(groupedByBrand).sort().forEach(brand => {
                        html += `<div class="brand-section">
                            <h3 class="brand-title">${brand}</h3>
                            <div class="products-grid">`;
                        
                        groupedByBrand[brand].forEach(product => {
                            html += `
                                <div class="product-card">
                                    <div class="product-image" style="background-image: url('${product.image_url || '/Online-Shoes-Store/Front-End/Images/Nike%20Air%201.jpeg'}'); background-size: cover; background-position: center;"></div>
                                    <div class="product-info">
                                        <div class="product-name">${product.name}</div>
                                        <div class="product-description">${product.description ? product.description.substring(0, 50) + '...' : 'Premium footwear'}</div>
                                        <div class="product-price">‚Ç®${parseFloat(product.price).toLocaleString()}</div>
                                        <div class="product-actions">
                                            <button class="btn btn-primary" onclick="addToCart(${product.id}, '${product.name}', ${product.price})">Add to Cart</button>
                                            <button class="btn btn-secondary" onclick="window.location.href='/Online-Shoes-Store/Front-End/product-reviews.html?productId=${product.id}'">üìù Review</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });

                        html += `</div></div>`;
                    });

                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // Cart functions
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');

        function addToCart(id, name, price) {
            const existing = cart.find(item => item.id === id);
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ id, name, price, quantity: 1, size: null });
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showMessage('Added to cart!', 'success');
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            displayCart();
            showMessage('Item removed from cart!', 'success');
        }

        function updateQuantity(id, newQuantity) {
            const item = cart.find(item => item.id === id);
            if (item) {
                if (newQuantity <= 0) {
                    removeFromCart(id);
                } else {
                    item.quantity = newQuantity;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartCount();
                    displayCart();
                }
            }
        }

        function updateSize(id, size) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.size = size || null;
                localStorage.setItem('cart', JSON.stringify(cart));
            }
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const countEl = document.getElementById('cartCount');
            if (count > 0) {
                countEl.textContent = count;
                countEl.style.display = 'flex';
            } else {
                countEl.style.display = 'none';
            }
        }

        function displayCart() {
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            cart = JSON.parse(localStorage.getItem('cart') || '[]');

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 40px 20px;"><p style="font-size: 18px; margin-bottom: 10px;">Your cart is empty</p><p style="font-size: 14px;">Add some shoes to get started!</p></div>';
                document.getElementById('cartTotal').textContent = '‚Ç®0';
                return;
            }

            let cartHTML = '';
            let total = 0;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                cartHTML += `
                    <div style="background: #f8f8f8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <div>
                                <h4 style="margin: 0 0 5px 0; color: #000; font-weight: 700;">${item.name}</h4>
                                <p style="margin: 0; color: #999; font-size: 12px;">‚Ç®${item.price.toLocaleString()} each</p>
                            </div>
                            <button onclick="removeFromCart(${item.id})" style="background: none; border: none; color: #ff4444; cursor: pointer; font-size: 18px; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">‚úï</button>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 12px; color: #666; font-weight: 600; display: block; margin-bottom: 5px;">Size (UK):</label>
                            <select id="size_${item.id}" onchange="updateSize(${item.id}, this.value)" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: white;">
                                <option value="">Select Size</option>
                                <option value="5" ${item.size === '5' ? 'selected' : ''}>5</option>
                                <option value="6" ${item.size === '6' ? 'selected' : ''}>6</option>
                                <option value="7" ${item.size === '7' ? 'selected' : ''}>7</option>
                                <option value="8" ${item.size === '8' ? 'selected' : ''}>8</option>
                                <option value="9" ${item.size === '9' ? 'selected' : ''}>9</option>
                                <option value="10" ${item.size === '10' ? 'selected' : ''}>10</option>
                                <option value="11" ${item.size === '11' ? 'selected' : ''}>11</option>
                                <option value="12" ${item.size === '12' ? 'selected' : ''}>12</option>
                                <option value="13" ${item.size === '13' ? 'selected' : ''}>13</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button onclick="updateQuantity(${item.id}, ${item.quantity - 1})" style="background: white; border: 1px solid #e0e0e0; width: 30px; height: 30px; cursor: pointer; border-radius: 4px; font-weight: 700; color: #000;">‚àí</button>
                                <input type="number" value="${item.quantity}" min="1" onchange="updateQuantity(${item.id}, this.value)" style="width: 40px; padding: 5px; border: 1px solid #e0e0e0; border-radius: 4px; text-align: center;">
                                <button onclick="updateQuantity(${item.id}, ${item.quantity + 1})" style="background: white; border: 1px solid #e0e0e0; width: 30px; height: 30px; cursor: pointer; border-radius: 4px; font-weight: 700; color: #000;">+</button>
                            </div>
                            <div style="font-weight: 700; color: #1a73e8;">‚Ç®${itemTotal.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            });

            cartItemsContainer.innerHTML = cartHTML;
            document.getElementById('cartTotal').textContent = '‚Ç®' + total.toLocaleString();
        }

        function toggleCart() {
            const modal = document.getElementById('cartModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'flex';
                displayCart();
            }
        }

        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }

        function goToCheckout() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            window.location.href = '/Online-Shoes-Store/Front-End/checkout.html';
        }

        function logout() {
            sessionStorage.removeItem('currentUser');
            localStorage.removeItem('currentUser');
            window.location.href = '/Online-Shoes-Store/index.html';
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type;
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        // Search function
        async function searchShoes() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            
            if (!searchTerm) {
                document.getElementById('searchResults').style.display = 'none';
                loadProducts();
                return;
            }

            try {
                const result = await Products.getAll(100, 0);
                const productsContainer = document.getElementById('productsContainer');
                
                if (!result.success || !result.data.products) {
                    loadProducts();
                    return;
                }

                // Filter products based on search term
                const filteredProducts = result.data.products.filter(product => {
                    const productName = (product.name || '').toLowerCase();
                    const productBrand = (product.brand || '').toLowerCase();
                    const productDescription = (product.description || '').toLowerCase();
                    
                    return productName.includes(searchTerm) || 
                           productBrand.includes(searchTerm) || 
                           productDescription.includes(searchTerm);
                });

                // Display search results message
                if (filteredProducts.length === 0) {
                    document.getElementById('searchResults').innerHTML = `‚ùå No shoes found matching "${searchTerm}". Showing all products.`;
                    document.getElementById('searchResults').style.display = 'block';
                    loadProducts();
                    return;
                }

                document.getElementById('searchResults').innerHTML = `‚úÖ Found ${filteredProducts.length} shoe(s) matching "${searchTerm}"`;
                document.getElementById('searchResults').style.display = 'block';

                // Display filtered products grouped by brand
                const groupedByBrand = {};
                filteredProducts.forEach(product => {
                    const brand = product.brand || 'Other';
                    if (!groupedByBrand[brand]) {
                        groupedByBrand[brand] = [];
                    }
                    groupedByBrand[brand].push(product);
                });

                let html = '';
                Object.keys(groupedByBrand).sort().forEach(brand => {
                    html += `<div class="brand-section">
                        <h3 class="brand-title">${brand}</h3>
                        <div class="products-grid">`;
                    
                    groupedByBrand[brand].forEach(product => {
                        html += `
                            <div class="product-card">
                                <div class="product-image" style="background-image: url('${product.image_url || '/Online-Shoes-Store/Front-End/Images/Nike%20Air%201.jpeg'}'); background-size: cover; background-position: center;"></div>
                                <div class="product-info">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-description">${product.description ? product.description.substring(0, 50) + '...' : 'Premium footwear'}</div>
                                    <div class="product-price">‚Ç®${parseFloat(product.price).toLocaleString()}</div>
                                    <div class="product-actions">
                                        <button class="btn btn-primary" onclick="addToCart(${product.id}, '${product.name}', ${product.price})">Add to Cart</button>
                                        <button class="btn btn-secondary" onclick="window.location.href='/Online-Shoes-Store/Front-End/product-reviews.html?productId=${product.id}'">üìù Review</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    html += `</div></div>`;
                });

                productsContainer.innerHTML = html;
            } catch (error) {
                console.error('Error searching products:', error);
                loadProducts();
            }
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').style.display = 'none';
            loadProducts();
        }

        // Allow Enter key to search
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchShoes();
                    }
                });
            }
        });

        // Initialize
        loadUserInfo();
        loadProducts();
        updateCartCount();
    </script>
</body>
</html>
